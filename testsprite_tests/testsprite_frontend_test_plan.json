[
  {
    "id": "TC001",
    "title": "Email/Password Sign-In Success",
    "description": "Verify that users can sign in successfully using valid email and password credentials via Firebase Auth.",
    "category": "functional",
    "priority": "High",
    "steps": [
      {
        "type": "action",
        "description": "Navigate to /signin page."
      },
      {
        "type": "action",
        "description": "Fill [data-cy=\"input-username-email\"] with the provided username and fill [data-cy=\"input-password\"] with the provided password."
      },
      {
        "type": "action",
        "description": "Click [data-cy=\"submit-sign-in-with-password\"]."
      },
      {
        "type": "assertion",
        "description": "Verify user is authenticated: [data-testid=\"nav-bar\"] is visible and the app is no longer on /signin."
      },
      {
        "type": "assertion",
        "description": "Verify a post-login landing page is shown (role-appropriate content is visible)."
      }
    ]
  },
  {
    "id": "TC002",
    "title": "Google SSO Sign-In Success",
    "description": "Verify that users can authenticate successfully with Google Single Sign-On.",
    "category": "functional",
    "priority": "High",
    "steps": [
      {
        "type": "action",
        "description": "Navigate to /signin page."
      },
      {
        "type": "action",
        "description": "Select Google SSO authentication option."
      },
      {
        "type": "action",
        "description": "Complete Google authentication flow."
      },
      {
        "type": "assertion",
        "description": "Verify user is authenticated and redirected away from /signin."
      },
      {
        "type": "assertion",
        "description": "Verify landing page corresponds to authenticated user role."
      }
    ]
  },
  {
    "id": "TC003",
    "title": "Email Link Sign-In Flow Success",
    "description": "Verify that users can sign in via email link authentication flow and are routed correctly post-login.",
    "category": "functional",
    "priority": "High",
    "steps": [
      {
        "type": "action",
        "description": "Navigate to /signin and request email link authentication."
      },
      {
        "type": "action",
        "description": "Receive email with sign-in link and click on it."
      },
      {
        "type": "assertion",
        "description": "Verify user is authenticated upon link visit."
      },
      {
        "type": "assertion",
        "description": "Verify user redirected to role-appropriate landing page."
      }
    ]
  },
  {
    "id": "TC004",
    "title": "Sign-In Form Validation for Email/Password",
    "description": "Verify sign-in form validates email format, password non-empty, and displays appropriate error messages.",
    "category": "error handling",
    "priority": "High",
    "steps": [
      {
        "type": "action",
        "description": "Navigate to /signin page."
      },
      {
        "type": "action",
        "description": "Input invalid email format and any password."
      },
      {
        "type": "action",
        "description": "Attempt to submit the sign-in form."
      },
      {
        "type": "assertion",
        "description": "Verify validation error message for invalid email format is displayed."
      },
      {
        "type": "action",
        "description": "Input valid email and leave password empty."
      },
      {
        "type": "action",
        "description": "Attempt to submit the form."
      },
      {
        "type": "assertion",
        "description": "Verify validation error message for missing password is displayed."
      }
    ]
  },
  {
    "id": "TC005",
    "title": "Sign-In Failure with Incorrect Credentials",
    "description": "Verify that sign-in fails with incorrect email/password and proper error messages are shown.",
    "category": "error handling",
    "priority": "High",
    "steps": [
      {
        "type": "action",
        "description": "Navigate to /signin page."
      },
      {
        "type": "action",
        "description": "Input a registered email with incorrect password."
      },
      {
        "type": "action",
        "description": "Submit the sign-in form."
      },
      {
        "type": "assertion",
        "description": "Verify sign-in is rejected with an error message indicating authentication failure."
      }
    ]
  },
  {
    "id": "TC006",
    "title": "Participant Dashboard Assignment Selection",
    "description": "Verify participants can view assignments, select one, and tasks are rendered correctly with task tabs.",
    "category": "functional",
    "priority": "High",
    "steps": [
      {
        "type": "action",
        "description": "Sign in as participant and navigate to participant home page."
      },
      {
        "type": "assertion",
        "description": "Verify list of available assignments is displayed."
      },
      {
        "type": "action",
        "description": "Select a specific assignment."
      },
      {
        "type": "assertion",
        "description": "Verify tasks related to the assignment are loaded and rendered with correct tabs."
      },
      {
        "type": "assertion",
        "description": "Verify UI components for tasks (GameTabs, ParticipantSidebar) are displayed and functional."
      }
    ]
  },
  {
    "id": "TC007",
    "title": "Participant Survey Experience with Locale and Audio",
    "description": "Verify that surveys load locale-specific text, play audio for the locale correctly, and progress saves/restores during sessions.",
    "category": "functional",
    "priority": "High",
    "steps": [
      {
        "type": "action",
        "description": "Sign in as participant with non-default locale set."
      },
      {
        "type": "action",
        "description": "Start a survey task."
      },
      {
        "type": "assertion",
        "description": "Verify survey text is loaded according to user locale."
      },
      {
        "type": "assertion",
        "description": "Verify corresponding audio for survey survey items plays and uses fallback if audio missing."
      },
      {
        "type": "action",
        "description": "Partially complete the survey and leave."
      },
      {
        "type": "action",
        "description": "Resume survey in a new session."
      },
      {
        "type": "assertion",
        "description": "Verify previously entered progress is restored accurately."
      }
    ]
  },
  {
    "id": "TC008",
    "title": "Admin User and Organization Management UI",
    "description": "Verify that administrators can list groups, list users, add users, and create assignments via the admin interface.",
    "category": "functional",
    "priority": "High",
    "steps": [
      {
        "type": "action",
        "description": "Sign in as administrator and navigate to admin landing page."
      },
      {
        "type": "action",
        "description": "Navigate to groups listing page."
      },
      {
        "type": "assertion",
        "description": "Verify groups are listed correctly."
      },
      {
        "type": "action",
        "description": "Navigate to users listing page."
      },
      {
        "type": "assertion",
        "description": "Verify users are displayed with correct roles and organization info."
      },
      {
        "type": "action",
        "description": "Access add user page and input user details with roles."
      },
      {
        "type": "action",
        "description": "Submit new user creation."
      },
      {
        "type": "assertion",
        "description": "Verify new user is added and visible in the users list."
      },
      {
        "type": "action",
        "description": "Navigate to create assignment page, enter all required fields, and submit."
      },
      {
        "type": "assertion",
        "description": "Verify the assignment is created and appears in assignment lists."
      }
    ]
  },
  {
    "id": "TC009",
    "title": "Admin Management Error Handling",
    "description": "Verify that validation errors are shown when required data is missing or invalid during user creation and assignment creation.",
    "category": "error handling",
    "priority": "Medium",
    "steps": [
      {
        "type": "action",
        "description": "Go to add user interface and submit without user email."
      },
      {
        "type": "assertion",
        "description": "Verify validation error about missing email is displayed."
      },
      {
        "type": "action",
        "description": "Go to create assignment form and submit with missing required fields."
      },
      {
        "type": "assertion",
        "description": "Verify validation error messages are shown for missing assignment data."
      }
    ]
  },
  {
    "id": "TC010",
    "title": "Post-Login Route Guarding",
    "description": "Verify that users cannot access restricted routes for other roles and are redirected appropriately based on their authenticated user role.",
    "category": "security",
    "priority": "High",
    "steps": [
      {
        "type": "action",
        "description": "Sign in as participant."
      },
      {
        "type": "action",
        "description": "Attempt to access admin routes via URL."
      },
      {
        "type": "assertion",
        "description": "Verify user is redirected back to participant landing page or an error page."
      },
      {
        "type": "action",
        "description": "Sign in as administrator."
      },
      {
        "type": "action",
        "description": "Attempt to access participant routes via URL."
      },
      {
        "type": "assertion",
        "description": "Verify user is redirected to admin landing or error page."
      }
    ]
  },
  {
    "id": "TC011",
    "title": "Translation File Loading and Rendering",
    "description": "Verify that CSV-based Crowdin translation files compile correctly into modular JSON locale files and are reflected correctly in UI components.",
    "category": "functional",
    "priority": "Medium",
    "steps": [
      {
        "type": "action",
        "description": "Trigger translation build process from CSV inputs."
      },
      {
        "type": "assertion",
        "description": "Verify modular JSON locale files are generated without errors."
      },
      {
        "type": "action",
        "description": "Load application with locale set to a non-default language."
      },
      {
        "type": "assertion",
        "description": "Verify UI components display translated text correctly."
      },
      {
        "type": "assertion",
        "description": "Verify no missing translation keys appear in the UI."
      }
    ]
  },
  {
    "id": "TC012",
    "title": "Survey Audio Fallback when Locale Audio Missing",
    "description": "Verify that the survey audio playback falls back to default locale audio if the current locale audio file is not available.",
    "category": "functional",
    "priority": "Medium",
    "steps": [
      {
        "type": "action",
        "description": "Sign in as participant with a locale lacking specific survey audio."
      },
      {
        "type": "action",
        "description": "Start a survey item that requires audio playback."
      },
      {
        "type": "assertion",
        "description": "Verify audio plays using default locale fallback file."
      }
    ]
  },
  {
    "id": "TC013",
    "title": "Survey Progress Persistence During Intermittent Sessions",
    "description": "Verify that survey progress is saved if user loses connectivity or leaves mid-survey and seamlessly restored on return.",
    "category": "functional",
    "priority": "High",
    "steps": [
      {
        "type": "action",
        "description": "Start survey as participant and answer several questions."
      },
      {
        "type": "action",
        "description": "Simulate network disconnect or close browser tab."
      },
      {
        "type": "action",
        "description": "Re-login and resume survey."
      },
      {
        "type": "assertion",
        "description": "Verify previous answers and progress are correctly restored."
      }
    ]
  },
  {
    "id": "TC014",
    "title": "Invalid User Access After Logout",
    "description": "Verify accessing any restricted page after logout redirects to /signin and clears session data.",
    "category": "security",
    "priority": "High",
    "steps": [
      {
        "type": "action",
        "description": "Login as any user."
      },
      {
        "type": "action",
        "description": "Logout successfully."
      },
      {
        "type": "action",
        "description": "Attempt to navigate directly using URL to participant or admin pages."
      },
      {
        "type": "assertion",
        "description": "Verify user is redirected to /signin page."
      },
      {
        "type": "assertion",
        "description": "Verify no residual session or cached data is accessible."
      }
    ]
  },
  {
    "id": "TC101",
    "title": "Researcher Workflow: Add Site Group",
    "description": "From README_RESEARCHERS.md Step 1: Add Groups. Verify an admin can create a new Site group from the Groups page.",
    "category": "functional",
    "priority": "High",
    "code": "import asyncio\nimport os\nimport re\nimport time\nfrom playwright.async_api import async_playwright, expect\n\nasync def run_test():\n    email = os.environ.get('EMAIL')\n    password = os.environ.get('PASSWORD')\n    if not email or not password:\n        raise RuntimeError('Missing EMAIL/PASSWORD in environment')\n\n    group_name = f\"testsprite-site-{int(time.time())}\"\n\n    async with async_playwright() as p:\n        browser = await p.chromium.launch(\n            headless=True,\n            args=[\n                '--window-size=1280,720',\n                '--disable-dev-shm-usage',\n                '--ipc=host',\n                '--single-process',\n            ],\n        )\n        context = await browser.new_context()\n        page = await context.new_page()\n\n        await page.goto('http://localhost:5173/signin', wait_until='domcontentloaded', timeout=30000)\n\n        await page.locator('[data-cy=\"input-username-email\"]').fill(email)\n        await page.locator('[data-cy=\"input-password\"]').fill(password)\n        await page.locator('[data-cy=\"submit-sign-in-with-password\"]').click()\n\n        await page.locator('[data-testid=\"nav-bar\"]').wait_for(state='visible', timeout=30000)\n        await expect(page).not_to_have_url(re.compile(r'.*/signin$'), timeout=30000)\n\n        await page.locator('[data-cy=\"nav-groups\"]').click()\n        try:\n            await page.wait_for_url('**/list-groups', timeout=30000)\n        except Exception:\n            pass\n\n        # Page may not fully render tables on emulator if claims docs are missing; still allow modal.\n        try:\n            await page.locator('[data-testid=\"groups-page-ready\"]').wait_for(state='visible', timeout=60000)\n        except Exception:\n            pass\n\n        await page.locator('[data-testid=\"add-group-btn\"]').click()\n        await page.locator('[data-testid=\"modalTitle\"]').wait_for(state='visible', timeout=20000)\n\n        # Best-effort: ensure org type is \"Site\".\n        try:\n            await page.locator('[data-testid=\"dropdown-org-type\"]').click(timeout=2000)\n            site_option = page.get_by_role('option', name=re.compile(r'^\\s*Site\\s*$', re.I))\n            if await site_option.count():\n                await site_option.first.click(timeout=5000)\n        except Exception:\n            pass\n\n        await page.locator('[data-cy=\"input-org-name\"]').fill(group_name)\n        await page.locator('[data-testid=\"submitBtn\"]').click()\n\n        # Wait for modal close\n        try:\n            await page.locator('[data-testid=\"modalTitle\"]').wait_for(state='hidden', timeout=30000)\n        except Exception:\n            pass\n\n        # Verify by searching\n        await page.goto('http://localhost:5173/list-groups', wait_until='domcontentloaded', timeout=30000)\n        try:\n            await page.locator('[data-testid=\"groups-page-ready\"]').wait_for(state='visible', timeout=60000)\n        except Exception:\n            pass\n\n        await page.locator('[data-cy=\"search-groups-input\"]').fill(group_name)\n        await expect(page.get_by_text(group_name)).to_be_visible(timeout=20000)\n\n        await context.close()\n        await browser.close()\n\nasyncio.run(run_test())\n",
    "steps": [
      {
        "type": "action",
        "description": "Navigate to /signin. Sign in using ONLY these selectors: [data-cy=\"input-username-email\"], [data-cy=\"input-password\"], then click [data-cy=\"submit-sign-in-with-password\"]. Do NOT use XPath selectors."
      },
      {
        "type": "action",
        "description": "Wait for post-login UI: [data-testid=\"nav-bar\"] is visible. Then either navigate directly to /list-groups OR click the Groups nav item via [data-cy=\"nav-groups\"]. Prefer [data-cy=\"nav-groups\"]."
      },
      {
        "type": "action",
        "description": "On /list-groups, wait for [data-testid=\"groups-page-ready\"] to be present before interacting with the page."
      },
      {
        "type": "action",
        "description": "Click Add Group button: [data-testid=\"add-group-btn\"]. Verify modal title [data-testid=\"modalTitle\"] is visible."
      },
      {
        "type": "action",
        "description": "In the Add Group modal, the Group Type should already default to \"Site\". If it is not already \"Site\", open Group Type dropdown and select the option with visible text exactly \"Site\"."
      },
      {
        "type": "action",
        "description": "Enter a UNIQUE site name into [data-cy=\"input-org-name\"] (must be unique across sites). Use a prefix like \"e2e-site-testsprite-\" plus a timestamp. Do NOT click in the groups table when entering the name."
      },
      {
        "type": "action",
        "description": "Submit the modal by clicking [data-testid=\"submitBtn\"]."
      },
      {
        "type": "assertion",
        "description": "Do NOT rely on toast timing. Verify the modal closes (modalTitle not visible). Then reload /list-groups and find the group by typing the created name into the search input with placeholder \"Search groups\" and verify the group name is visible in results."
      }
    ]
  }
]
